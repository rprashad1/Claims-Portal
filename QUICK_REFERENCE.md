# Quick Reference - Driver & Injury Workflow

## The Problem (Before)
? Unclear when data is saved  
? Feature creation disconnected from injury entry  
? Users don't know if their data was captured  
? No feedback after feature creation  

## The Solution (After)
? **Clear save point**: "Save Driver & Create Feature" button  
? **Automatic modal**: Opens after clicking save  
? **Visual feedback**: Feature grid shows all created features  
? **Atomic saves**: All data saved together  

---

## Visual Workflow

```
?????????????????????????????????????????????
? 1??  SELECT DRIVER TYPE                    ?
?    • Insured    • Listed    • Unlisted    ?
?????????????????????????????????????????????
                    ?
?????????????????????????????????????????????
? 2??  ENTER DRIVER DETAILS                   ?
?    (Name, License, etc.)                  ?
?????????????????????????????????????????????
                    ?
?????????????????????????????????????????????
? 3??  INJURED?                               ?
?    ?? Yes    ?? No                         ?
?????????????????????????????????????????????
          ?           ?
      YES              NO
       ?                ?
????????????????   ????????????????????
? 4??  Injury    ?   ? ?? SAVE DRIVER   ?
?    Details   ?   ? (No feature)     ?
????????????????   ????????????????????
       ?
????????????????
? 5??  Attorney  ?
?    Details   ?
????????????????
       ?
????????????????????????????????????????????
? ?? SAVE DRIVER & CREATE FEATURE          ?
?    (Large Primary Button)                ?
?    ? Validates all fields                ?
?    ? Opens feature modal                 ?
????????????????????????????????????????????
       ?
????????????????????????????????????????????
? ?? FEATURE CREATION MODAL                 ?
?    • Coverage Type                       ?
?    • Expense Reserve: $                  ?
?    • Indemnity Reserve: $                ?
?    • Assign Adjuster                     ?
?    • Summary preview                     ?
?    [Cancel] [? Create Feature]           ?
????????????????????????????????????????????
       ?
????????????????????????????????????????????
? ? FEATURE SAVED                          ?
?    Modal closes                          ?
?    Feature added to grid                 ?
?    Driver marked complete                ?
????????????????????????????????????????????
       ?
????????????????????????????????????????????
? ?? FEATURES GRID                          ?
?    Feature ? Coverage ? Reserves ? ...   ?
?    01      ? BI/300   ? $5K/$25K ? ?? ???  ?
????????????????????????????????????????????
       ?
????????????????????????????????????????????
? ??  ADD PASSENGERS & CONTINUE             ?
????????????????????????????????????????????
```

---

## Key Concepts

### Save Button
```
?? SAVE DRIVER & CREATE FEATURE

• Only shows when driver is injured
• Disabled until all required fields filled
• Validates: Driver info, Injury details, Attorney details
• Opens feature modal automatically
• OR marks driver saved if no injury
```

### Feature Modal
```
Opens automatically after clicking save

Required Fields:
? Coverage Type (BI, PD, PIP, APIP, UM)
? Expense Reserve (dollar amount)
? Indemnity Reserve (dollar amount)
? Assigned Adjuster (Raj, Edwin, Constantine, Joan)

Shows Summary Before Creating:
- Coverage with limits
- Both reserves
- Assigned adjuster name
```

### Feature Grid
```
?? CREATED FEATURES/SUB-CLAIMS

Feature | Coverage   | Claimant | Exp Res | Ind Res | Adjuster | Actions
01      | BI-100/300 | Insured  | $5K     | $25K    | Raj      | ?? ???
02      | PD-50K     | Insured  | $2K     | $10K    | Edwin    | ?? ???

Features auto-numbered (01, 02, 03...)
Can edit any feature - values update in place
Can delete any feature - others renumber automatically
```

---

## State Tracking

### DriverSaved Flag
Controls whether user can proceed to next step

```
DriverSaved = false  ?  ? Next button disabled
DriverSaved = true   ?  ? Next button enabled
```

Gets set to `true` when:
1. User clicks save AND has no injury
2. OR user completes feature creation

---

## Validation Rules

### To Enable Save Button:
```
? Driver name is empty
? Nature of injury is empty (if injured)
? Medical treatment date is empty (if injured)
? Injury description is empty (if injured)
? Attorney name/firm is empty (if attorney selected)

? Button stays disabled until all filled
```

### To Enable Create Feature Button (in modal):
```
? Coverage type not selected
? Expense reserve is 0 or empty
? Indemnity reserve is 0 or empty
? Adjuster not selected

? Button stays disabled until all filled
```

---

## Three Scenarios

### Scenario A: No Injury
```
Driver: John Doe
Injured: ? No
? Click "Save Driver & Create Feature"
? DriverSaved = true
? No feature created
? Ready for Step 4
```

### Scenario B: Injured, No Attorney
```
Driver: John Doe
Injured: ? Yes
- Nature: Whiplash
- Date: 2024-01-15
- Description: Neck pain
Attorney: ? No

? Click "Save Driver & Create Feature"
? Feature modal opens
? Fill coverage, reserves, adjuster
? Click "Create Feature"
? Feature 01 appears in grid
? DriverSaved = true
? Ready for Step 4
```

### Scenario C: Injured with Attorney
```
Driver: John Doe
Injured: ? Yes
- Nature: Whiplash
- Date: 2024-01-15
- Description: Neck pain
Attorney: ? Yes
- Name: Jane Smith
- Firm: Smith Law

? All attorney fields required
? Click "Save Driver & Create Feature"
? Feature modal opens
? Fill coverage, reserves, adjuster
? Click "Create Feature"
? Feature 01 appears in grid
? DriverSaved = true
? Ready for Step 4
```

---

## Testing Checklist

- [ ] No injury flow works - no feature created
- [ ] Injury flow - feature modal opens automatically
- [ ] Feature created with correct numbers (01, 02)
- [ ] Feature grid shows all values correctly
- [ ] Edit feature - values update in place
- [ ] Delete feature - remaining renumber correctly
- [ ] Save button disabled when fields empty
- [ ] Create feature button disabled when fields empty
- [ ] Next button disabled until DriverSaved = true
- [ ] Next button enabled after feature created
- [ ] Modal closes after feature created
- [ ] Modal shows correct driver name

---

## File Changes

### Updated Files:
1. **FnolStep3_DriverAndInjury.razor**
   - Added DriverSaved flag
   - Added CanSaveDriver() validation
   - Added SaveDriverAndCreateFeature() method
   - Reorganized UI to show button only when injured
   - Feature grid now prominently displayed

2. **SubClaimModal.razor**
   - Enhanced with claimant name display
   - Added summary section
   - Better organized layout
   - Improved validation messages

### Documentation Created:
- WORKFLOW_GUIDE.md - Visual workflow diagrams
- IMPLEMENTATION_DETAILS.md - Code changes explained
- DATA_MODEL.md - Complete data structure
- QUICK_REFERENCE.md - This file

---

## Success Metrics

After implementation:
- ? Users see clear "Save" button - they know when to save
- ? Feature modal opens automatically - no confusion
- ? Feature grid shows results immediately - clear feedback
- ? All data saved together - no missing pieces
- ? Intuitive flow - matches how users think
- ? Flexible editing - can change anything before next step

