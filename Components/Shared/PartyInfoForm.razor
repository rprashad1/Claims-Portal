@using ClaimsPortal.Models

<div class="party-info-form">
    <!-- Basic Information -->
    <div class="card mb-3">
        <div class="card-header bg-light">
            <h6 class="mb-0">@(string.IsNullOrEmpty(Title) ? "Party Information" : Title)</h6>
        </div>
        <div class="card-body">
            <!-- Entity Type Selection -->
            <div class="mb-3">
                <label class="form-label">Type *</label>
                <div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="entityType" id="entityIndividual" 
                               value="Individual" @onchange="@((ChangeEventArgs e) => SetEntityType((string?)e.Value))" 
                               checked="@(PartyData.EntityType == "Individual")" />
                        <label class="form-check-label" for="entityIndividual">Individual</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="entityType" id="entityBusiness" 
                               value="Business" @onchange="@((ChangeEventArgs e) => SetEntityType((string?)e.Value))" 
                               checked="@(PartyData.EntityType == "Business")" />
                        <label class="form-check-label" for="entityBusiness">Business</label>
                    </div>
                </div>
            </div>

            <!-- Name Fields -->
            @if (PartyData.EntityType == "Business")
            {
                <div class="mb-3">
                    <label class="form-label">Business Name *</label>
                    <input type="text" class="form-control" @bind="PartyData.BusinessName" 
                           placeholder="Legal business name" />
                </div>
                <div class="mb-3">
                    <label class="form-label">Doing Business As (DBA)</label>
                    <input type="text" class="form-control" @bind="PartyData.DoingBusinessAs" 
                           placeholder="DBA name if applicable" />
                </div>
            }
            else
            {
                <div class="mb-3">
                    <label class="form-label">Full Name *</label>
                    <input type="text" class="form-control" @bind="PartyData.Name" 
                           placeholder="First and Last Name" />
                </div>
                <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Date of Birth</label>
                        <input type="date" class="form-control" @bind="PartyData.DateOfBirth" />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Driver License Number</label>
                        <input type="text" class="form-control" @bind="PartyData.LicenseNumber" />
                    </div>
                </div>
                @if (!string.IsNullOrEmpty(PartyData.LicenseNumber))
                {
                    <div class="mb-3">
                        <label class="form-label">License State</label>
                        <input type="text" class="form-control" @bind="PartyData.LicenseState" 
                               maxlength="2" placeholder="State code" />
                    </div>
                }
            }

            <!-- Identification -->
            <div class="mb-3">
                <label class="form-label">FEIN/SS# @(IncludeFeinSsNumber ? "*" : "")</label>
                <input type="text" class="form-control" @bind="PartyData.FeinSsNumber" 
                       placeholder="@(PartyData.EntityType == "Business" ? "Federal Employer ID Number" : "Social Security Number")" />
                <small class="text-muted">
                    @(PartyData.EntityType == "Business" ? "FEIN (9 digits)" : "SSN (9 digits, format: XXX-XX-XXXX)")
                </small>
            </div>
        </div>
    </div>

    <!-- Address Information -->
    <div class="card mb-3">
        <div class="card-header bg-light">
            <h6 class="mb-0">Address Information</h6>
        </div>
        <div class="card-body">
            <AddressSearchInput @bind-Address1="PartyData.Address"
                               @bind-Address2="PartyData.Address2"
                               @bind-City="PartyData.City"
                               @bind-State="PartyData.State"
                               @bind-ZipCode="PartyData.ZipCode"
                               Label1="Street Address"
                               Label2="Apt/Suite/Unit"
                               IsRequired="true"
                               AutoFillFromSearch="true" />
        </div>
    </div>

    <!-- Contact Information -->
    <div class="card mb-3">
        <div class="card-header bg-light">
            <h6 class="mb-0">Contact Information</h6>
        </div>
        <div class="card-body">
            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label class="form-label">Phone Number *</label>
                    <input type="tel" class="form-control" @bind="PartyData.PhoneNumber" 
                           placeholder="(555) 000-0000" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">Additional Phone (Optional)</label>
                    <input type="tel" class="form-control" @bind="PartyData.Phone2" 
                           placeholder="(555) 000-0000" />
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label">Email Address</label>
                <input type="email" class="form-control" @bind="PartyData.Email" 
                       placeholder="email@example.com" />
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public Party PartyData { get; set; } = new();

    [Parameter]
    public EventCallback<Party> PartyDataChanged { get; set; }

    [Parameter]
    public string Title { get; set; } = string.Empty;

    [Parameter]
    public bool IncludeFeinSsNumber { get; set; } = true;

    private void SetEntityType(string? entityType)
    {
        PartyData.EntityType = entityType ?? "Individual";
        
        // Clear business-specific fields when switching to individual
        if (PartyData.EntityType == "Individual")
        {
            PartyData.BusinessName = null;
            PartyData.DoingBusinessAs = null;
        }
        else
        {
            PartyData.Name = string.Empty;
            PartyData.DateOfBirth = null;
            PartyData.LicenseNumber = null;
            PartyData.LicenseState = null;
        }
    }
}
