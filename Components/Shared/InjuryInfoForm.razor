@using ClaimsPortal.Models

<div class="injury-info-form">
    <div class="card">
        <div class="card-header bg-light">
            <h6 class="mb-0">@(string.IsNullOrEmpty(Title) ? "Injury Information" : Title)</h6>
        </div>
        <div class="card-body">
            <!-- Injury Type -->
            <div class="mb-3">
                <label class="form-label">Injury Type *</label>
                <select class="form-select" @bind="InjuryData.InjuryType">
                    <option value="">-- Select Injury Type --</option>
                    @foreach (var injury in InjuryTypes)
                    {
                        <option value="@injury">@injury</option>
                    }
                </select>
            </div>

            <!-- Severity Level -->
            <div class="mb-3">
                <label class="form-label">Severity Level *</label>
                <div class="d-flex gap-2">
                    @for (int i = 1; i <= 5; i++)
                    {
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="severityLevel" 
                                   id="severity@i" value="@i" 
                                   @onchange="@((ChangeEventArgs e) => SetSeverity(int.Parse((string?)e.Value ?? "1")))" 
                                   checked="@(InjuryData.SeverityLevel == i)" />
                            <label class="form-check-label" for="severity@i">
                                @GetSeverityLabel(i)
                            </label>
                        </div>
                    }
                </div>
            </div>

            <!-- Date of Injury -->
            <div class="mb-3">
                <label class="form-label">Date of Injury *</label>
                <input type="date" class="form-control" @bind="InjuryData.DateOfInjury" />
            </div>

            <!-- Injury Description -->
            <div class="mb-3">
                <label class="form-label">Injury Description *</label>
                <textarea class="form-control" rows="4" @bind="InjuryData.InjuryDescription" 
                          placeholder="Provide detailed description of the injury..."></textarea>
                <small class="text-muted">Include location, severity, visible injuries, etc.</small>
            </div>

            <!-- Medical Information Section -->
            <div class="card mb-3">
                <div class="card-header bg-light">
                    <h6 class="mb-0">Medical Information</h6>
                </div>
                <div class="card-body">
                    <!-- First Medical Treatment Date -->
                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Date of First Medical Treatment *</label>
                            <input type="date" class="form-control" @bind="InjuryData.FirstMedicalTreatmentDate" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Treating Physician</label>
                            <input type="text" class="form-control" @bind="InjuryData.TreatingPhysician" 
                                   placeholder="Physician name" />
                        </div>
                    </div>

                    <!-- Fatality Checkbox -->
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="isFatality" 
                                   @bind="InjuryData.IsFatality" />
                            <label class="form-check-label" for="isFatality">Fatality</label>
                        </div>
                    </div>

                    <!-- Hospital Information -->
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="wasTakenToHospital" 
                                   @bind="InjuryData.WasTakenToHospital" />
                            <label class="form-check-label" for="wasTakenToHospital">
                                Taken to Hospital
                            </label>
                        </div>
                    </div>

                    @if (InjuryData.WasTakenToHospital)
                    {
                        <div class="alert alert-info mb-3">
                            <i class="bi bi-info-circle"></i> Hospital Information
                        </div>
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Hospital Name</label>
                                <input type="text" class="form-control" @bind="InjuryData.HospitalName" 
                                       placeholder="Hospital name" />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Hospital Address</label>
                                <input type="text" class="form-control" @bind="InjuryData.HospitalAddress" 
                                       placeholder="Street address" />
                            </div>
                        </div>
                        <div class="row g-3 mb-3">
                            <div class="col-md-4">
                                <label class="form-label">City</label>
                                <input type="text" class="form-control" @bind="InjuryData.HospitalCity" 
                                       placeholder="City" />
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">State</label>
                                <input type="text" class="form-control" @bind="InjuryData.HospitalState" 
                                       maxlength="2" placeholder="State" />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Zip Code</label>
                                <input type="text" class="form-control" @bind="InjuryData.HospitalZipCode" 
                                       placeholder="Zip code" />
                            </div>
                        </div>
                    }

                    <!-- Preexisting Conditions -->
                    <div class="mb-3">
                        <label class="form-label">Preexisting Conditions</label>
                        <textarea class="form-control" rows="3" @bind="InjuryData.PreexistingConditions" 
                                  placeholder="Note any preexisting medical conditions..."></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public InjuryRecord InjuryData { get; set; } = new();

    [Parameter]
    public EventCallback<InjuryRecord> InjuryDataChanged { get; set; }

    [Parameter]
    public string Title { get; set; } = string.Empty;

    [Parameter]
    public List<string> InjuryTypes { get; set; } = new()
    {
        "Back Sprain",
        "Leg Injury",
        "Head Injury",
        "Neck Injury (Whiplash)",
        "Fracture",
        "Internal Injury",
        "Burns",
        "Burn",
        "Lacerations",
        "Contusions",
        "Other"
    };

    private void SetSeverity(int level)
    {
        InjuryData.SeverityLevel = level;
    }

    private string GetSeverityLabel(int level)
    {
        return level switch
        {
            1 => "1 (Minor)",
            2 => "2 (Moderate)",
            3 => "3 (Serious)",
            4 => "4 (Severe)",
            5 => "5 (Critical)",
            _ => "Unknown"
        };
    }
}
