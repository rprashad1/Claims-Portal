@page "/"
@using ClaimsPortal.Models
@using ClaimsPortal.Services
@rendermode InteractiveServer

<div class="container-fluid py-4">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="mb-1">
                <i class="bi bi-speedometer2"></i> Claims Dashboard
            </h1>
            <p class="text-muted">Welcome to the Auto Insurance Claims Management System</p>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card bg-primary text-white shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-0 opacity-75">Total Claims</h6>
                            <h2 class="mb-0">@TotalClaims</h2>
                        </div>
                        <i class="bi bi-folder fs-1 opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card bg-success text-white shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-0 opacity-75">My Open Claims</h6>
                            <h2 class="mb-0">@OpenClaims</h2>
                        </div>
                        <i class="bi bi-exclamation-circle fs-1 opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card bg-warning text-dark shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-0 opacity-75">In Review</h6>
                            <h2 class="mb-0">@InReviewClaims</h2>
                        </div>
                        <i class="bi bi-hourglass-split fs-1 opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card bg-info text-white shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-0 opacity-75">Adjusters</h6>
                            <h2 class="mb-0">@AdjusterCount</h2>
                        </div>
                        <i class="bi bi-person-circle fs-1 opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title mb-3">Quick Actions</h5>
                    <div class="btn-group" role="group">
                        <a href="/fnol/new" class="btn btn-primary">
                            <i class="bi bi-file-earmark-plus"></i> New FNOL (First Notice of Loss)
                        </a>
                        <a href="/claims" class="btn btn-outline-primary">
                            <i class="bi bi-folder"></i> View All Claims
                        </a>
                        <a href="/claims/search" class="btn btn-outline-primary">
                            <i class="bi bi-search"></i> Search Claims
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Claims Table -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header border-bottom py-3">
                    <h5 class="mb-0">Recent Claims Activity</h5>
                </div>
                <div class="card-body">
                    @if (RecentClaimsList.Count > 0)
                    {
                        <div class="table-responsive">
                            <table class="table table-hover table-sm">
                                <thead class="table-light">
                                    <tr>
                                        <th>Claim Number</th>
                                        <th>Policy Number</th>
                                        <th>Insured</th>
                                        <th>Date of Loss</th>
                                        <th>Status</th>
                                        <th>Created</th>
                                        <th class="text-end">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var claim in RecentClaimsList)
                                    {
                                        <tr>
                                            <td><strong>@claim.ClaimNumber</strong></td>
                                            <td>@claim.PolicyNumber</td>
                                            <td>@claim.InsuredParty.Name</td>
                                            <td>@claim.LossDetails.DateOfLoss.ToString("MM/dd/yyyy")</td>
                                            <td>
                                                <span class="badge @GetStatusBadge(claim.Status)">@claim.Status</span>
                                            </td>
                                            <td>
                                                <small>@claim.CreatedDate.ToString("MM/dd/yyyy hh:mm tt")</small>
                                            </td>
                                            <td class="text-end">
                                                <a href="@($"/claim/{claim.ClaimNumber}")" class="btn btn-sm btn-outline-primary">
                                                    <i class="bi bi-eye"></i> View
                                                </a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> No claims found. <a href="/fnol/new">Create a new FNOL</a>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    [Inject]
    private IClaimService ClaimService { get; set; } = null!;

    [Inject]
    private IAdjusterService AdjusterService { get; set; } = null!;

    private List<Models.Claim> AllClaimsList = [];
    private List<Models.Claim> RecentClaimsList = [];
    private int TotalClaims = 0;
    private int OpenClaims = 0;
    private int InReviewClaims = 0;
    private int AdjusterCount = 0;

    protected override async Task OnInitializedAsync()
    {
        AllClaimsList = await ClaimService.GetAllClaimsAsync();
        var adjusters = await AdjusterService.GetAllAdjustersAsync();

        TotalClaims = AllClaimsList.Count;
        OpenClaims = AllClaimsList.Count(c => c.Status == "Open");
        InReviewClaims = AllClaimsList.Count(c => c.Status == "Investigation");
        AdjusterCount = adjusters.Count;

        RecentClaimsList = AllClaimsList
            .OrderByDescending(c => c.CreatedDate)
            .Take(10)
            .ToList();
    }

    private string GetStatusBadge(string status) => status switch
    {
        "Open" => "bg-success",
        "CIQ" => "bg-warning",
        "Investigation" => "bg-info",
        "Closed" => "bg-secondary",
        _ => "bg-secondary"
    };
}
