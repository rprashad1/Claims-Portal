@using ClaimsPortal.Models
@using ClaimsPortal.Services

<div class="modal fade" id="vendorViewModal" tabindex="-1" role="dialog" aria-labelledby="vendorViewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="vendorViewModalLabel">
                    <i class="bi bi-eye"></i> View Vendor - @Vendor?.GetDisplayName()
                </h5>
                <button type="button" class="btn-close" @onclick="OnCancel" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                @if (Vendor != null)
                {
                    <!-- Basic Information -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">Basic Information</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Vendor Type</label>
                                    <p class="text-secondary">@GetVendorTypeDisplay(Vendor.VendorType)</p>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Entity Type</label>
                                    <p class="text-secondary">@Vendor.EntityType</p>
                                </div>
                            </div>

                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">
                                        @(Vendor.EntityType == EntityType.Business ? "Company Name" : "Full Name")
                                    </label>
                                    <p class="text-secondary">@Vendor.Name</p>
                                </div>
                                @if (Vendor.EntityType == EntityType.Business && !string.IsNullOrEmpty(Vendor.DoingBusinessAs))
                                {
                                    <div class="col-md-6">
                                        <label class="form-label fw-semibold">Doing Business As (DBA)</label>
                                        <p class="text-secondary">@Vendor.DoingBusinessAs</p>
                                    </div>
                                }
                            </div>

                            <div class="row g-3 mb-3">
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">FEIN #</label>
                                    <p class="text-secondary">@Vendor.FeinNumber</p>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Effective Date</label>
                                    <p class="text-secondary">@Vendor.EffectiveDate?.ToString("MM/dd/yyyy")</p>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Termination Date</label>
                                    <p class="text-secondary">
                                        @if (Vendor.TerminationDate.HasValue)
                                        {
                                            @Vendor.TerminationDate?.ToString("MM/dd/yyyy")
                                        }
                                        else
                                        {
                                            <span class="text-muted">(None)</span>
                                        }
                                    </p>
                                </div>
                            </div>

                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Status</label>
                                    <p>
                                        @if (Vendor.Status == VendorStatus.Active)
                                        {
                                            <span class="badge bg-success">Active</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-secondary">Disabled</span>
                                        }
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tax and Compliance Information -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">Tax & Compliance Information</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="w9Received" @bind="Vendor.W9Received" disabled />
                                        <label class="form-check-label" for="w9Received">
                                            W-9 Received
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="subjectTo1099" @bind="Vendor.SubjectTo1099" disabled />
                                        <label class="form-check-label" for="subjectTo1099">
                                            Subject to 1099
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="backupWithholding" @bind="Vendor.BackupWithholding" disabled />
                                        <label class="form-check-label" for="backupWithholding">
                                            Backup Withholding
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">Contact Information</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Contact Name</label>
                                    <p class="text-secondary">
                                        @if (!string.IsNullOrEmpty(Vendor.Contact?.Name))
                                        {
                                            @Vendor.Contact.Name
                                        }
                                        else
                                        {
                                            <span class="text-muted">(Not provided)</span>
                                        }
                                    </p>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Email</label>
                                    <p class="text-secondary">
                                        @if (!string.IsNullOrEmpty(Vendor.Contact?.EmailAddress))
                                        {
                                            <a href="mailto:@Vendor.Contact.EmailAddress">@Vendor.Contact.EmailAddress</a>
                                        }
                                        else
                                        {
                                            <span class="text-muted">(Not provided)</span>
                                        }
                                    </p>
                                </div>
                            </div>

                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Business Phone</label>
                                    <p class="text-secondary">
                                        @if (!string.IsNullOrEmpty(Vendor.Contact?.BusinessPhone))
                                        {
                                            <a href="tel:@Vendor.Contact.BusinessPhone">@Vendor.Contact.BusinessPhone</a>
                                        }
                                        else
                                        {
                                            <span class="text-muted">(Not provided)</span>
                                        }
                                    </p>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Mobile Phone</label>
                                    <p class="text-secondary">
                                        @if (!string.IsNullOrEmpty(Vendor.Contact?.MobilePhone))
                                        {
                                            <a href="tel:@Vendor.Contact.MobilePhone">@Vendor.Contact.MobilePhone</a>
                                        }
                                        else
                                        {
                                            <span class="text-muted">(Not provided)</span>
                                        }
                                    </p>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Fax Number</label>
                                    <p class="text-secondary">
                                        @if (!string.IsNullOrEmpty(Vendor.Contact?.FaxNumber))
                                        {
                                            @Vendor.Contact.FaxNumber
                                        }
                                        else
                                        {
                                            <span class="text-muted">(Not provided)</span>
                                        }
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Addresses Section -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">Addresses</h6>
                        </div>
                        <div class="card-body">
                            @if (Vendor.Addresses.Count == 0)
                            {
                                <div class="alert alert-info mb-0">
                                    <i class="bi bi-info-circle"></i> No addresses on file.
                                </div>
                            }
                            else
                            {
                                <div class="row g-3">
                                    @foreach (var address in Vendor.Addresses)
                                    {
                                        <div class="col-md-6">
                                            <div class="card border">
                                                <div class="card-header bg-light">
                                                    <h6 class="mb-0">@GetAddressTypeDisplay(address.AddressType)</h6>
                                                </div>
                                                <div class="card-body p-2">
                                                    <p class="mb-1">
                                                        <strong>@address.StreetAddress</strong>
                                                    </p>
                                                    @if (!string.IsNullOrEmpty(address.AddressLine2))
                                                    {
                                                        <p class="mb-1">@address.AddressLine2</p>
                                                    }
                                                    <p class="mb-0">@address.GetCityStateZip()</p>
                                                    <small class="text-muted d-block mt-2">
                                                        @if (address.Status == AddressStatus.Active)
                                                        {
                                                            <span class="badge bg-success">Active</span>
                                                        }
                                                        else
                                                        {
                                                            <span class="badge bg-secondary">Disabled</span>
                                                        }
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            }
                        </div>
                    </div>

                    <!-- Payment Information -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">Payment Information</h6>
                        </div>
                        <div class="card-body">
                            @if (Vendor.Payment == null)
                            {
                                <p class="text-muted">No payment information available.</p>
                            }
                            else
                            {
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label fw-semibold">Payment Schedule</label>
                                        <p class="text-secondary">@Vendor.Payment.GetPaymentScheduleDisplay()</p>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>

                    <!-- Audit Information -->
                    <div class="card">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">Record Information</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Created</label>
                                    <p class="text-secondary">
                                        @Vendor.CreatedDate.ToString("MM/dd/yyyy HH:mm")
                                        @if (!string.IsNullOrEmpty(Vendor.CreatedBy))
                                        {
                                            <br />
                                            <small class="text-muted">By: @Vendor.CreatedBy</small>
                                        }
                                    </p>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Last Updated</label>
                                    <p class="text-secondary">
                                        @if (Vendor.LastUpdatedDate.HasValue)
                                        {
                                            @Vendor.LastUpdatedDate?.ToString("MM/dd/yyyy HH:mm")
                                            @if (!string.IsNullOrEmpty(Vendor.LastUpdatedBy))
                                            {
                                                <br />
                                                <small class="text-muted">By: @Vendor.LastUpdatedBy</small>
                                            }
                                        }
                                        else
                                        {
                                            <span class="text-muted">(Not updated)</span>
                                        }
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" @onclick="OnCancel">Close</button>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public Vendor? Vendor { get; set; }

    [Parameter]
    public EventCallback OnModalClosed { get; set; }

    [Inject]
    private IJSRuntime JS { get; set; } = null!;

    public async Task ShowAsync(Vendor? vendor)
    {
        Vendor = vendor;
        await JS.InvokeVoidAsync("ShowModal", "vendorViewModal");
    }

    private async Task OnCancel()
    {
        await OnModalClosed.InvokeAsync();
        await JS.InvokeVoidAsync("HideModal", "vendorViewModal");
    }

    private string GetVendorTypeDisplay(VendorType type) => type switch
    {
        VendorType.MedicalProvider => "Medical Provider",
        VendorType.Hospital => "Hospital",
        VendorType.DefenseAttorney => "Defense Attorney",
        VendorType.PlaintiffAttorney => "Plaintiff Attorney",
        VendorType.TowingService => "Towing Service",
        VendorType.RepairShop => "Repair Shop",
        VendorType.RentalCarCompany => "Rental Car Company",
        VendorType.InsuranceCarrier => "Insurance Carrier",
        VendorType.Other => "Other",
        _ => "Unknown"
    };

    private string GetAddressTypeDisplay(AddressTypeEnum type) => type switch
    {
        AddressTypeEnum.Main => "Main Address",
        AddressTypeEnum.Temporary => "Temporary Address",
        AddressTypeEnum.Alternate => "Alternate Address",
        _ => "Unknown"
    };
}
